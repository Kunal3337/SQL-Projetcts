/* Explore All Objects in the Database */
SELECT * FROM INFORMATION_SCHEMA.TABLES

-- Explore All columns in the database
SELECT * FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'erp_cust_az12'

-- Explore All columns in the database for specific table
SELECT * FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'erp_cust_az12'

--DIMENSIONS EXPLORATION

--Explore all countries our customers come from
SELECT DISTINCT country from gold.dim_customers

SELECT * from gold.dim_customers

-- Explore all categories "The major Divisions"
SELECT DISTINCT category FROM gold.dim_product

-- Find the date of the first and last orders
select
min(order_date) first_order_date,
max(order_date) last_order_date,
datediff(year,min(order_date),max(order_date)) as year_difference
from gold.fact_sales

-- Find the youngest and the oldest customer
SELECT
min(birthdate) as oldest_birthdate,
max(birthdate) as youngest_birthdate
from gold.dim_customers

-- Measures Exploration

SELECT * FROM INFORMATION_SCHEMA.COLUMNS
-- Find the total sales
select sum(sales_amount) as total_sales from gold.fact_sales

-- Find how many items are sold
select sum(quantity) as total_quantity from gold.fact_sales

-- Find the average selling price
select avg(price) as total_price from gold.fact_sales

-- Find the total number of orders
SELECT count(order_number) as total_order from gold.fact_sales
SELECT count( distinct order_number) as total_order from gold.fact_sales

-- Find the total number of products
SELECT COUNT(product_name) AS total_products from gold.dim_product
SELECT COUNT(distinct product_name) AS total_products from gold.dim_product

-- FInd the total number of customers
SELECT count(customer_key) as total_customers from gold.dim_customers

-- Find the total number of customers that has placed an order
SELECT 'total customers' as Total_Customers, count(distinct customer_key) as total_customers from gold.fact_sales

-- Magnitude

SELECT * FROM INFORMATION_SCHEMA.COLUMNS

-- Find the total customers by countries
select country, count(customer_key) as total_customer from gold.dim_customers group by country

-- Find total customers by gender
select gender, count(customer_key) from gold.dim_customers group by gender

-- Find total products by category
SELECT category,
count(product_key) AS total_products
from gold.dim_product group by category

-- What is the average costs in each category
select category,
avg(cost) as avg_costs from gold.dim_product group by category

-- What is the total revenue generated for each category
select DP.category,SUM(FS.sales_amount) as total_revenue from gold.dim_product as DP
right join gold.fact_sales FS
ON  DP.product_key = FS.product_key
group by DP.category

-- What is the total revenue is generated by each customer
select customer_key, sum(sales_amount) from gold.fact_sales group by customer_key

-- Which 5 products generate the highest revenue
select top 5 p.product_name,
sum(f.sales_amount) total_revenue
from gold.fact_sales f 
left join gold.dim_product p 
on p.product_key = f.product_key
group by p.product_name 
order by total_revenue desc

-- What are the 5 worst-performing products in terms of sales
select top 5 p.product_name,
sum(f.sales_amount) total_revenue
from gold.fact_sales f 
left join gold.dim_product p 
on p.product_key = f.product_key
group by p.product_name 
order by total_revenue

-- The 3 Customers with the fewest orders placed
select top 3 
c.customer_key,
c.first_name,
c.last_name,
count(DISTINCT order_number) as total_orders
from gold.fact_sales f 
left join gold.dim_customers c 
on c.customer_key = f.customer_key
group by 
c.customer_key,
c.first_name,
c.last_name
order by total_orders

-- CHANGE OVER TIME ANALYSIS

-- Analyze sales over time

select 
YEAR(order_date) as order_year,
MONTH(order_date) as order_year,
SUM(sales_amount) as total_sales
from gold.fact_sales
where order_date is not null 
group by YEAR(order_date), MONTH(order_date)

-- CUMMULATIVE ANALYSIS

-- Calculate the total sales per month and the running total of sales over time

--Running total sales month wise
select
order_month,
total_sales_monthlykk,
sum(total_sales_monthlykk) over(order by order_month) dakdh from 
(select
datetrunc(month,order_date) as order_month,
sum(sales_amount) total_sales_monthlykk
from gold.fact_sales
where order_date is not null 
group by datetrunc(month,order_date))t

-- Running total sales year wise
select order_year,
total_sales_monthlykk,
sum(total_sales_monthlykk) over(order by order_year) dakdh from 
(select
datetrunc(year,order_date) as order_year,
sum(sales_amount) total_sales_monthlykk
from gold.fact_sales
where order_date is not null 
group by datetrunc(year,order_date))t
